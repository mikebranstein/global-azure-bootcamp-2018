{"version":3,"sources":["../src/sdk/speech.browser/SpeechConnectionFactory.ts"],"names":[],"mappings":";;AAAA,wDAAmE;AACnE,gDAK8B;AAC9B,6CAQ2B;AAE3B,IAAM,kBAAkB,GAAW,WAAW,CAAC;AAC/C,IAAM,kBAAkB,GAAW,gBAAgB,CAAC;AAEpD;IAAA;QAAA,iBA2DC;QAzDU,WAAM,GAAG,UACZ,MAAwB,EACxB,QAAkB,EAClB,YAAqB;YAErB,gBAAgB;YAChB,iBAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;YAE/C,IAAI,QAAQ,GAAG,EAAE,CAAC;YAClB,MAAM,CAAC,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC,CAAC;gBAC7B,KAAK,yBAAe,CAAC,YAAY;oBAC7B,QAAQ,GAAG,KAAI,CAAC,IAAI,GAAG,KAAI,CAAC,uBAAuB,CAAC;oBACpD,KAAK,CAAC;gBACV,KAAK,yBAAe,CAAC,SAAS;oBAC1B,QAAQ,GAAG,KAAI,CAAC,IAAI,GAAG,KAAI,CAAC,oBAAoB,CAAC;oBACjD,KAAK,CAAC;gBACV;oBACI,QAAQ,GAAG,KAAI,CAAC,IAAI,GAAG,KAAI,CAAC,sBAAsB,CAAC,CAAC,yBAAyB;oBAC7E,KAAK,CAAC;YACd,CAAC;YAED,IAAM,WAAW,GAA8B;gBAC3C,MAAM,EAAE,4BAAkB,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,CAAC,WAAW,EAAE;gBAClE,QAAQ,EAAE,MAAM,CAAC,QAAQ;aAC5B,CAAC;YAEF,EAAE,CAAC,CAAC,KAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC;gBAC1B,WAAW,CAAC,kBAAkB,CAAC,GAAG,GAAG,CAAC;YAC1C,CAAC;YAED,IAAM,OAAO,GAA8B,EAAE,CAAC;YAC9C,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC;YAC9C,OAAO,CAAC,kBAAkB,CAAC,GAAG,YAAY,CAAC;YAE3C,MAAM,CAAC,IAAI,6BAAmB,CAAC,QAAQ,EAAE,WAAW,EAAE,OAAO,EAAE,IAAI,mCAAyB,EAAE,EAAE,YAAY,CAAC,CAAC;QAClH,CAAC,CAAA;IAsBL,CAAC;IApBG,sBAAY,yCAAI;aAAhB;YACI,MAAM,CAAC,iBAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,oDAAoD,CAAC,CAAC;QAChG,CAAC;;;OAAA;IAED,sBAAY,2DAAsB;aAAlC;YACI,MAAM,CAAC,iBAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,wBAAwB,EAAE,sDAAsD,CAAC,CAAC;QACpH,CAAC;;;OAAA;IAED,sBAAY,4DAAuB;aAAnC;YACI,MAAM,CAAC,iBAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,yBAAyB,EAAE,uDAAuD,CAAC,CAAC;QACtH,CAAC;;;OAAA;IAED,sBAAY,yDAAoB;aAAhC;YACI,MAAM,CAAC,iBAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,sBAAsB,EAAE,oDAAoD,CAAC,CAAC;QAChH,CAAC;;;OAAA;IAED,sBAAY,uDAAkB;aAA9B;YACI,IAAM,KAAK,GAAG,iBAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,oBAAoB,EAAE,OAAO,CAAC,CAAC;YACpE,MAAM,CAAC,KAAK,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC;QAC1C,CAAC;;;OAAA;IACL,8BAAC;AAAD,CA3DA,AA2DC,IAAA;AA3DY,0DAAuB","file":"SpeechConnectionFactory.js","sourcesContent":["import { WebsocketConnection } from \"../../common.browser/Exports\";\nimport {\n    IConnection,\n    IStringDictionary,\n    Promise,\n    Storage,\n} from \"../../common/Exports\";\nimport {\n    AuthInfo,\n    IAuthentication,\n    IConnectionFactory,\n    RecognitionMode,\n    RecognizerConfig,\n    SpeechResultFormat,\n    WebsocketMessageFormatter,\n} from \"../speech/Exports\";\n\nconst TestHooksParamName: string = \"testhooks\";\nconst ConnectionIdHeader: string = \"X-ConnectionId\";\n\nexport class SpeechConnectionFactory implements IConnectionFactory {\n\n    public Create = (\n        config: RecognizerConfig,\n        authInfo: AuthInfo,\n        connectionId?: string): IConnection => {\n\n        // setup baseURL\n        Storage.Local.GetOrAdd(\"Host\", config.BaseURL);\n\n        let endpoint = \"\";\n        switch (config.RecognitionMode) {\n            case RecognitionMode.Conversation:\n                endpoint = this.Host + this.ConversationRelativeUri;\n                break;\n            case RecognitionMode.Dictation:\n                endpoint = this.Host + this.DictationRelativeUri;\n                break;\n            default:\n                endpoint = this.Host + this.InteractiveRelativeUri; // default is interactive\n                break;\n        }\n\n        const queryParams: IStringDictionary<string> = {\n            format: SpeechResultFormat[config.Format].toString().toLowerCase(),\n            language: config.Language,\n        };\n\n        if (this.IsDebugModeEnabled) {\n            queryParams[TestHooksParamName] = \"1\";\n        }\n\n        const headers: IStringDictionary<string> = {};\n        headers[authInfo.HeaderName] = authInfo.Token;\n        headers[ConnectionIdHeader] = connectionId;\n\n        return new WebsocketConnection(endpoint, queryParams, headers, new WebsocketMessageFormatter(), connectionId);\n    }\n\n    private get Host(): string {\n        return Storage.Local.GetOrAdd(\"Host\", \"wss://1a4467c35d614039add5e706567a44da.api.cris.ai\");\n    }\n\n    private get InteractiveRelativeUri(): string {\n        return Storage.Local.GetOrAdd(\"InteractiveRelativeUri\", \"/speech/recognition/interactive/cognitiveservices/v1\");\n    }\n\n    private get ConversationRelativeUri(): string {\n        return Storage.Local.GetOrAdd(\"ConversationRelativeUri\", \"/speech/recognition/conversation/cognitiveservices/v1\");\n    }\n\n    private get DictationRelativeUri(): string {\n        return Storage.Local.GetOrAdd(\"DictationRelativeUri\", \"/speech/recognition/dictation/cognitiveservices/v1\");\n    }\n\n    private get IsDebugModeEnabled(): boolean {\n        const value = Storage.Local.GetOrAdd(\"IsDebugModeEnabled\", \"false\");\n        return value.toLowerCase() === \"true\";\n    }\n}\n"]}